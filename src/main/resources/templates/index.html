<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSN - Tin t·ª©c m·ªõi nh·∫•t</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/nav.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .colored-toast {
            border-radius: 8px !important;
            padding: 15px 25px !important;
        }
        .colored-toast.success {
            background: linear-gradient(to right, #00b09b, #96c93d) !important;
        }
        .colored-toast.error {
            background: linear-gradient(to right, #ff5f6d, #ffc371) !important;
        }
        .colored-toast.info {
            background: linear-gradient(to right, #2193b0, #6dd5ed) !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div th:replace="~{Giaodien/Nav :: nav}"></div>

    <!-- Main Content -->
    <main class="container">
        <!-- B√†i vi·∫øt n·ªïi b·∫≠t -->
        <section class="featured-posts">
            <div th:if="${hasArticles}" class="posts-grid">
                <!-- B√†i vi·∫øt n·ªïi b·∫≠t ch√≠nh (c·ªôt tr√°i) -->
                <div th:if="${baiViets != null and not #lists.isEmpty(baiViets)}" 
                     th:with="mainPost=${baiViets[0]}" class="main-post">
                    <a th:href="@{/bai-viet/{id}(id=${mainPost.maBaiViet})}" class="post-link">
                        <div class="post-image">
                            <img th:if="${mainPost.duongDanAnh1 != null and mainPost.duongDanAnh1 != ''}"
                                 th:data-src="${mainPost.duongDanAnh1}"
                                 alt="H√¨nh ·∫£nh b√†i vi·∫øt">
                        </div>
                        <div class="post-content">
                            <h3 class="post-title" th:text="${mainPost.tieuDe}">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h3>
                            <div class="post-meta">
                                <span class="post-date" th:text="${#temporals.format(mainPost.ngayXuatBan, 'dd/MM/yyyy')}">Ng√†y ƒëƒÉng</span>
                            </div>
                        </div>
                    </a>
                </div>
                
                <!-- 3 b√†i vi·∫øt ph·ª• (c·ªôt ph·∫£i) -->
                <div class="secondary-posts">
                    <!-- B√†i vi·∫øt l·ªõn ·ªü tr√™n -->
                    <div th:if="${baiViets != null and #lists.size(baiViets) > 1}" 
                         th:with="secondPost=${baiViets[1]}" 
                         class="post-card">
                        <a th:href="@{/bai-viet/{id}(id=${secondPost.maBaiViet})}" class="post-link">
                            <div class="post-image">
                                <img th:if="${secondPost.duongDanAnh1 != null and secondPost.duongDanAnh1 != ''}"
                                     th:data-src="${secondPost.duongDanAnh1}"
                                     alt="H√¨nh ·∫£nh b√†i vi·∫øt">
                            </div>
                            <div class="post-content">
                                <h3 class="post-title" th:text="${secondPost.tieuDe}">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h3>
                                <div class="post-meta">
                                    <span class="post-date" th:text="${#temporals.format(secondPost.ngayXuatBan, 'dd/MM/yyyy')}">Ng√†y ƒëƒÉng</span>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- 2 b√†i vi·∫øt nh·ªè ·ªü d∆∞·ªõi -->
                    <div class="bottom-posts">
                        <div th:each="baiViet, iterStat : ${baiViets}" 
                             th:if="${iterStat.index > 1 && iterStat.index <= 3}" 
                             class="post-card">
                            <a th:href="@{/bai-viet/{id}(id=${baiViet.maBaiViet})}" class="post-link">
                                <div class="post-image">
                                    <img th:if="${baiViet.duongDanAnh1 != null and baiViet.duongDanAnh1 != ''}"
                                         th:data-src="${baiViet.duongDanAnh1}"
                                         alt="H√¨nh ·∫£nh b√†i vi·∫øt">
                                </div>
                                <div class="post-content">
                                    <h3 class="post-title" th:text="${baiViet.tieuDe}">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h3>
                                    <div class="post-meta">
                                        <span class="post-date" th:text="${#temporals.format(baiViet.ngayXuatBan, 'dd/MM/yyyy')}">Ng√†y ƒëƒÉng</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div th:unless="${hasArticles}" class="no-posts">
                <p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o ƒë∆∞·ª£c xu·∫•t b·∫£n.</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{Giaodien/Foter :: footer}"></div>

    <!-- JavaScript -->
    <script th:src="@{/js/nav.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const message = /*[[${message}]]*/ null;
            const error = /*[[${error}]]*/ null;
            
            function showToast(message, type = 'success') {
                Toastify({
                    text: message,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    className: `colored-toast ${type}`,
                    stopOnFocus: true,
                    close: true,
                    style: {
                        background: "none",
                        boxShadow: "0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3)"
                    }
                }).showToast();
            }
            
            if (message) {
                if (message.includes("ƒêƒÉng k√Ω th√†nh c√¥ng")) {
                    showToast("‚úÖ " + message);
                    // Show login prompt after successful registration
                    setTimeout(() => {
                        showToast("üëã B·∫°n c√≥ mu·ªën ƒëƒÉng nh·∫≠p ngay?", "info");
                    }, 1000);
                } else {
                    showToast("‚úÖ " + message);
                }
            }
            
            if (error) {
                showToast("‚ùå " + error, "error");
            }
        });
    </script>
    <script>
        // Convert base64 data to image src
        function convertBase64ToImage() {
            const images = document.querySelectorAll('img[data-src]');
            images.forEach(img => {
                const base64Data = img.getAttribute('data-src');
                if (base64Data && base64Data.trim() !== '') {
                    img.src = 'data:image/jpeg;base64,' + base64Data;
                }
            });
        }
        
        // Run when page loads
        document.addEventListener('DOMContentLoaded', function() {
            convertBase64ToImage();
        });
    </script>
</body>
</html>